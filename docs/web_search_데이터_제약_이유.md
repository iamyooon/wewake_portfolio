# OpenAI가 "web_search로 실시간 데이터 조회 불가"라고 하는 이유

## 왜 그런가?

**지금 스크립트는 OpenAI API에 "텍스트만" 보내고, 웹 검색(web_search) 기능은 쓰지 않기 때문입니다.**

1. **호출 방식**
   - `generate_portfolio_report_3ai.py`는 **프롬프트 문자열**만 OpenAI에 보냅니다.
   - 응답도 **텍스트(보고서)**만 받습니다.
   - **도구(tools)** 로 web_search, 브라우징, 실시간 검색 등을 붙여 주지 않습니다.

2. **모델 입장**
   - API 호출 시점에 모델이 가진 건 **프롬프트 텍스트**와 **학습 데이터(컷오프 시점까지)** 뿐입니다.
   - 인터넷 접속이나 검색 API가 없으므로, "실시간 환율", "2026-01-30 전일 종가" 같은 **실시간 데이터를 스스로 조회할 수 없다**고 말하는 것이 맞습니다.

3. **프롬프트와의 차이**
   - `portfolio_prompt.txt`에는  
     `"환율: web_search로 검색된 실시간 USD/KRW 환율을 그대로 적용하라"`  
     라고 되어 있지만,
   - **실제 API 호출에는 web_search를 켜는 설정이 없습니다.**
   - 그래서 모델이 "현재 대화 환경에서는 web_search로 조회할 수 없습니다"라고 하는 것입니다.

정리하면, **환경(우리 스크립트)이 web_search를 제공하지 않아서** 그렇게 말하는 것입니다.

---

## 어떻게 하면 될까?

**실시간 데이터를 "스크립트에서 먼저 조회"한 뒤, 그 값을 프롬프트에 넣어 주면** 됩니다.

- **스크립트에서 할 일**
  - 실행 시점에 USD/KRW 환율을 (예: 한 은행/환율 API 또는 스크래핑) 조회
  - (선택) 주요 종목 전일 종가를 API/스크래핑으로 조회
  - 조회한 값을 문자열로 만들어 **프롬프트 안에 "제공 데이터" 블록**으로 삽입

- **프롬프트 수정**
  - "web_search로 검색하라" 대신  
    **"아래 [제공된 실시간 데이터]를 반드시 사용하라. 이 수치로 보고서를 작성하라"** 로 바꿉니다.

이렇게 하면:
- 모델은 "현재 대화 환경에서는 web_search 불가"라고 말할 **이유가 없고**,
- 대신 "아래 제공된 환율/종가를 사용했다"는 식으로 보고서를 작성하게 됩니다.

원하면 다음 단계로 **스크립트에 환율(및 필요 시 종가) 조회 + 프롬프트 삽입** 예시 코드까지 이어서 정리해 줄 수 있습니다.
